!function(t,i){"use strict";"undefined"!=typeof exports?module.exports=i(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],i):i(t._,t.Backbone)}(this,function(t,i){"use strict";var e=function(t){return t instanceof i.Model},r=function(t){return t instanceof i.Collection},s=function(i){return i.extend({_modelAttrs:{},constructor:function(){i.apply(this,arguments),this._copyModelAttr(this.attributes),this.dirty=!1},set:t.wrap(i.prototype.set,function(t,i,e,r){t.call(this,i,e,r),this._checkDirty(this)}),sync:t.wrap(i.prototype.sync,function(i,e,r,s){s=s||{};var n=["update","create","patch"];return t.contains(n,e)&&(s.success=t.wrap(s.success,t.bind(function(t,i,e,s){var n;return t&&(n=t.call(this,i,e,s)),this._copyModelAttr(r),this.resetDirty(),n},this))),i(e,r,s)}),isDirty:function(){return this.dirty},rollback:function(i){var r=e(i)?i.attributes:i||{};t.isEmpty(r)||this._copyModelAttr(r),this.set(this._modelAttrs),this.resetDirty()},resetDirty:function(){this.dirty=!1,this.changed={}},_checkDirty:function(i){var s=!1;t.each(i.attributes,function(i,n){return t.has(this._modelAttrs,n)||e(i)&&r(i)?void 0:void(s=!0)},this),this.dirty=s||!t.isEqual(t.pick(i.attributes,t.keys(this._modelAttrs)),this._modelAttrs),this.dirty&&this.trigger("dirty",this)},_copyModelAttr:function(i){var s={},n=t.clone(i);t.each(n,function(t,i){e(t)||r(t)||(s[i]=t)}),this._modelAttrs=s}})},n=i.DirtyModel=s(i.Model);return{DirtyModel:n,dirtyModelFactory:s}});
